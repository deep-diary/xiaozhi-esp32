# 人脸检测 log 分析：对人脸 vs 对天花板

## 场景划分（按时间戳，用户说明）

- **约 38s 前（~Frame 1–24）**：摄像头**对天花板**
- **约 43s 后（~Frame 28–51）**：摄像头**对人脸**

（17s 启动，约 21s 开始有检测；38s 前对天花板，43s 后对人脸。）

---

## 1. 对天花板阶段（38s 前，threshold=0.96, min_box=55）

| 指标 | 现象 |
|------|------|
| 有检测的帧 | 1～3 张“脸”/帧，score 0.96～1.00 |
| **Face not detected** | **很多**：Frame 3、7–10、14、17–23、25、27、33–34、36–37、40–41、45 等连续多帧为 0 |
| box 坐标 | 仍全部 `box=(x, 0)`，y0=0 |

结论：阈值 0.96 + 最小框 55 对天花板**抑制明显**，大量帧被滤成“未检测到”，但仍有部分帧误检 1～3 张。

---

## 2. 对人脸阶段（43s 后）

| 指标 | 现象 |
|------|------|
| 有检测的帧 | 1～3 张/帧，score 0.96～1.00 |
| **Face not detected** | **仍然很多**：Frame 33–34、36–37、40–41、45、51 等，对人脸时也频繁“未检测到” |
| box 坐标 | 全部 `box=(x, 0)`，y0=0 |

结论：**对人脸时漏检严重**——真人脸在画面里却多帧报“Face not detected”，说明当前阈值/最小框**过严**，把真人脸也滤掉了。

---

## 3. 问题归纳（本次 log）

1. **天花板**：0.96/55 下误检已减少（大量“未检测到”），但仍有零星空洞误检。
2. **人脸**：0.96/55 下**漏检太多**，对人脸时也经常“未检测到”，阈值/最小框偏严。
3. **矛盾**：压低天花板误检（提高阈值）→ 人脸漏检增加；放宽以抓人脸（降低阈值）→ 天花板误检又会增多，需要**折中**。
4. **所有框 y0=0**：坐标解析或摄像头角度问题仍未解决，需以屏上绿框是否包住人脸为准核对 `FACE_DETECT_BOX_SWAP_XY`。

## 4. 「所有框都是 box=(x, 0)」正常吗？

**不正常**。在「摄像头正对人脸、人脸在画面中央或偏中」的典型场景下，人脸框的 y 应在画面内变化（例如 y 约 40～180），不会每帧都顶在 y=0。

可能原因：

| 情况 | 说明 |
|------|------|
| **坐标顺序设错** | 模型实际是 [x0,y0,x1,y1]，却用 SWAP_XY=1 按 [y0,x0] 解析，会把「左边一竖条」(x=0) 显示成「顶上一横排」(y=0)。 |
| **摄像头角度** | 摄像头在人上方、朝下拍，人脸始终在画面最上方，这时 y0≈0 可能成立，但每帧都 0 仍少见。 |
| **对天花板** | 误检框多在画面上半部，模型可能习惯性给 y0≈0。 |

**建议**：以**屏上绿框是否包住真人脸**为准——对人脸时若框在画面顶部/左侧一条且没包住脸，可尝试改 `FACE_DETECT_BOX_SWAP_XY`（0 与 1 互换）再试；改对后对人脸 log 里 box 的 (x,y) 会都有合理变化，而不是全是 (x,0) 或 (0,y)。

---

## 5. 建议调整（config.h）— 折中方案

本次 log 显示：**0.96/55 对天花板有效，但对人脸漏检太多**。建议略放宽，在“少漏人脸”和“少误检天花板”之间折中：

| 配置项 | 曾用值 | 建议 | 说明 |
|--------|--------|------|------|
| `FACE_DETECT_SCORE_THRESHOLD` | 0.96 | **0.94** | 略降以减少对人脸漏检，天花板误检会略增，可再微调 |
| `FACE_DETECT_MIN_BOX_SIZE` | 55 | **52** | 略降以保留略小人脸框，减少漏检 |
| 若人脸仍漏检多 | — | 试 0.92 / 50 | 优先保证“对人脸能检出”，再视天花板误检情况微调 |

折中后若天花板误检仍多，可只把阈值再提到 0.95，避免一次提到 0.96 导致人脸再次漏检。
